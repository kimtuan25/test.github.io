<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Interactive Donut Chart</title>
  <!-- Plotly.js từ CDN -->
  <script src="https://cdn.plot.ly/plotly-latest.min.js"></script> <!-- :contentReference[oaicite:5]{index=5} -->
  <style>
    #chart {
      width: 100%;
      max-width: 600px;
      height: 400px;
      margin: 40px auto;
    }
  </style>
</head>
<body>
  <div id="chart"></div>
  <script>
    // Dữ liệu
    const labels = ['Open', 'In Analyse'];
    const values = [43, 31];

    // Trace donut cơ bản
    const trace = {
      type: 'pie',
      labels,
      values,
      hole: 0.5,
      pull: [0, 0],                    // default: không pull
      textinfo: 'percent',             // hiển thị % bên trong
      hoverinfo: 'label+value+percent',// hover hiển thị label, value, percent
      textposition: 'inside'
    };

    const layout = {
      margin: { t: 50, b: 20, l: 20, r: 20 },
      annotations: []                  // mặc định không có annotation
    };

    Plotly.newPlot('chart', [trace], layout, {responsive: true});

    const chart = document.getElementById('chart');

    // Khi hover: pull slice và thêm annotation
    chart.on('plotly_hover', function(eventData) {
      const pt = eventData.points[0];
      const updatePull = { 'pull': [0, 0] };
      updatePull.pull[pt.pointNumber] = 0.1;  // pull 10% lát hover
      Plotly.restyle(chart, updatePull);      // :contentReference[oaicite:6]{index=6}

      const newAnn = [{
        text: `${pt.value}<br>${(pt.percent*100).toFixed(2)}%`,
        x: 0.5, y: 0.5,
        showarrow: false,
        font: { size: 20 }
      }];
      Plotly.relayout(chart, {annotations: newAnn});
    });

    // Khi unhover: reset pull và xóa annotation
    chart.on('plotly_unhover', function() {
      Plotly.restyle(chart, {'pull': [0, 0]});  // reset pull :contentReference[oaicite:7]{index=7}
      Plotly.relayout(chart, {annotations: []}); // xóa annotation :contentReference[oaicite:8]{index=8}
    });
  </script>
</body>
</html>
